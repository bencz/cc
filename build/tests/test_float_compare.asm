*
* Generated by CC Compiler - HLASM Backend
*
CCPROG   CSECT
         USING *,12
*
*
* Function: compare_doubles
* Convenção z/OS: R1=param list, R13=save area, R14=return, R15=entry
*
compare_doubles DS    0H
         STM   14,12,12(13)      Save registers R14-R12
         LR    12,15             Establish base register
         USING compare_doubles,12
         LR    11,13             Save caller's save area in R11
         LA    13,SAVEcompare_doubles         Get our save area
         ST    11,4(,13)         Chain: our->prev = caller's
         ST    13,8(,11)         Chain: caller->next = ours
         LR    11,13             R11 = frame pointer (ebp)
*        R1 contains parameter list pointer
*        Parameters accessed via: L Rx,0(,1) for 1st, L Rx,4(,1) for 2nd, etc.
         LD    0,80(,11)        Load double from stack
         LD    0,88(,11)        Load double from stack
         LDR   4,0              F4 = F0 (temp)
         LDR   0,2              F0 = F2
         LDR   2,4              F2 = F4 (old F0)
         CDR   0,2              Compare F0 with F2
* FPU status word - condition code already set by CDR
         LR    0,2              Copy R2 to R0
         SRL   0,8              Shift right 8 bits
         N     0,=X'00000045' AND with mask
         LTR   0,0              Set condition code
         BNZ   L0001
         LA    2,1
*        Return: R15 contains return code, F0 for float/double
         LR    15,2              Copy return value to R15
         L     13,4(,13)         Restore caller's save area
         LM    14,12,12(13)      Restore registers R14-R12
         BR    14                Return to caller
L0001    DS    0H
         LD    0,80(,11)        Load double from stack
         LD    0,88(,11)        Load double from stack
         CDR   0,2              Compare F0 with F2
* FPU status word - condition code already set by CDR
         LR    0,2              Copy R2 to R0
         SRL   0,8              Shift right 8 bits
         N     0,=X'00000045' AND with mask
         LTR   0,0              Set condition code
         BNZ   L0002
         L     2,=F'-1'
*        Return: R15 contains return code, F0 for float/double
         LR    15,2              Copy return value to R15
         L     13,4(,13)         Restore caller's save area
         LM    14,12,12(13)      Restore registers R14-R12
         BR    14                Return to caller
L0002    DS    0H
         LA    2,0
*        Return: R15 contains return code, F0 for float/double
         LR    15,2              Copy return value to R15
         L     13,4(,13)         Restore caller's save area
         LM    14,12,12(13)      Restore registers R14-R12
         BR    14                Return to caller
*
* Function: main
* Convenção z/OS: R1=param list, R13=save area, R14=return, R15=entry
*
main     DS    0H
         STM   14,12,12(13)      Save registers R14-R12
         LR    12,15             Establish base register
         USING main,12
         LR    11,13             Save caller's save area in R11
         LA    13,SAVEmain         Get our save area
         ST    11,4(,13)         Chain: our->prev = caller's
         ST    13,8(,11)         Chain: caller->next = ours
         LR    11,13             R11 = frame pointer (ebp)
*        R1 contains parameter list pointer
*        Parameters accessed via: L Rx,0(,1) for 1st, L Rx,4(,1) for 2nd, etc.
         AHI   13,-36
         LD    0,=D'0'         Load double constant
         STD   0,64(,11)        Store double to stack
         LDR   2,0              Copy F0 to F2 (pop)
         LD    0,=D'8'         Load double constant
         STD   0,56(,11)        Store double to stack
         LDR   2,0              Copy F0 to F2 (pop)
         LD    0,=D'16'         Load double constant
         STD   0,48(,11)        Store double to stack
         LDR   2,0              Copy F0 to F2 (pop)
         LD    0,56(,11)        Load double from stack
         AHI   13,-8
         STD   0,0(,13)         Store and pop to stack
         LD    0,64(,11)        Load double from stack
         AHI   13,-8
         STD   0,0(,13)         Store and pop to stack
*        Call function: compare_doubles
         L     15,=V(compare_doubles)      Load function address
         BALR  14,15            Call function
         LR    2,15             Copy return value to R2 (eax)
         AHI   13,16
         ST    2,44(,11)
         LD    0,64(,11)        Load double from stack
         AHI   13,-8
         STD   0,0(,13)         Store and pop to stack
         LD    0,56(,11)        Load double from stack
         AHI   13,-8
         STD   0,0(,13)         Store and pop to stack
*        Call function: compare_doubles
         L     15,=V(compare_doubles)      Load function address
         BALR  14,15            Call function
         LR    2,15             Copy return value to R2 (eax)
         AHI   13,16
         ST    2,40(,11)
         LD    0,48(,11)        Load double from stack
         AHI   13,-8
         STD   0,0(,13)         Store and pop to stack
         LD    0,64(,11)        Load double from stack
         AHI   13,-8
         STD   0,0(,13)         Store and pop to stack
*        Call function: compare_doubles
         L     15,=V(compare_doubles)      Load function address
         BALR  14,15            Call function
         LR    2,15             Copy return value to R2 (eax)
         AHI   13,16
         ST    2,36(,11)
         L     3,44(,11)
         L     2,40(,11)
         AR    2,3
         LR    3,2
         L     2,36(,11)
         AR    2,3
*        Return: R15 contains return code, F0 for float/double
         LR    15,2              Copy return value to R15
         L     13,4(,13)         Restore caller's save area
         LM    14,12,12(13)      Restore registers R14-R12
         BR    14                Return to caller
*
* Function: _main
* Convenção z/OS: R1=param list, R13=save area, R14=return, R15=entry
*
_main    DS    0H
         STM   14,12,12(13)      Save registers R14-R12
         LR    12,15             Establish base register
         USING _main,12
         LR    11,13             Save caller's save area in R11
         LA    13,SAVE_main         Get our save area
         ST    11,4(,13)         Chain: our->prev = caller's
         ST    13,8(,11)         Chain: caller->next = ours
         LR    11,13             R11 = frame pointer (ebp)
*        R1 contains parameter list pointer
*        Parameters accessed via: L Rx,0(,1) for 1st, L Rx,4(,1) for 2nd, etc.
         AHI   13,-4
*        Call function: main
         L     15,=V(main)      Load function address
         BALR  14,15            Call function
         LR    2,15             Copy return value to R2 (eax)
         ST    2,68(,11)
*        Return: R15 contains return code, F0 for float/double
         LR    15,2              Copy return value to R15
         L     13,4(,13)         Restore caller's save area
         LM    14,12,12(13)      Restore registers R14-R12
         BR    14                Return to caller
*
* Data Section
*
         DC    D'10.500000'
         DC    D'3.200000'
         DC    D'10.500000'
*
* Work Areas
*
SAVEAREA DS    18F               Register save area (72 bytes)
PLIST    DS    16F               Parameter list (up to 16 params)
FTEMP    DS    D                 Temp for float conversions
ITEMP    DS    F                 Temp for integer conversions
*
* Function-specific save areas
*
SAVEcompare_doubles DS    18F               Save area for compare_doubles
SAVEmain DS    18F               Save area for main
SAVE_main DS    18F               Save area for _main
*
         LTORG                   Literal pool
*
*--------------------------------------------------------------------
* Notas sobre instruções de conversão:
* CDFBR F1,R2 - Convert from Fixed 32-bit to Long BFP (double)
* CFDBR R1,M3,F2 - Convert to Fixed 32-bit from Long BFP
*   M3=0: Use current rounding mode
*   M3=1: Round to nearest (ties to even)
*   M3=5: Round toward zero (truncate)
*   M3=6: Round toward +infinity
*   M3=7: Round toward -infinity
* Estas instruções requerem z/Architecture (z900+)
*--------------------------------------------------------------------
         END   CCPROG
