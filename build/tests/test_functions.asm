*
* Generated by CC Compiler - HLASM Backend
*
CCPROG   CSECT
         USING *,12
*
*
* Function: add
* Convenção z/OS: R1=param list, R13=save area, R14=return, R15=entry
*
add      DS    0H
         STM   14,12,12(13)      Save registers R14-R12
         LR    12,15             Establish base register
         USING add,12
         LR    11,13             Save caller's save area in R11
         LA    13,SAVEadd         Get our save area
         ST    11,4(,13)         Chain: our->prev = caller's
         ST    13,8(,11)         Chain: caller->next = ours
         LR    11,13             R11 = frame pointer (ebp)
*        R1 contains parameter list pointer
*        Parameters accessed via: L Rx,0(,1) for 1st, L Rx,4(,1) for 2nd, etc.
         L     3,80(,11)
         L     2,84(,11)
         AR    2,3
*        Return: R15 contains return code, F0 for float/double
         LR    15,2              Copy return value to R15
         L     13,4(,13)         Restore caller's save area
         LM    14,12,12(13)      Restore registers R14-R12
         BR    14                Return to caller
*
* Function: multiply
* Convenção z/OS: R1=param list, R13=save area, R14=return, R15=entry
*
multiply DS    0H
         STM   14,12,12(13)      Save registers R14-R12
         LR    12,15             Establish base register
         USING multiply,12
         LR    11,13             Save caller's save area in R11
         LA    13,SAVEmultiply         Get our save area
         ST    11,4(,13)         Chain: our->prev = caller's
         ST    13,8(,11)         Chain: caller->next = ours
         LR    11,13             R11 = frame pointer (ebp)
*        R1 contains parameter list pointer
*        Parameters accessed via: L Rx,0(,1) for 1st, L Rx,4(,1) for 2nd, etc.
         L     2,80(,11)
         M     2,84(,11)
         LR    2,3
*        Return: R15 contains return code, F0 for float/double
         LR    15,2              Copy return value to R15
         L     13,4(,13)         Restore caller's save area
         LM    14,12,12(13)      Restore registers R14-R12
         BR    14                Return to caller
*
* Function: main
* Convenção z/OS: R1=param list, R13=save area, R14=return, R15=entry
*
main     DS    0H
         STM   14,12,12(13)      Save registers R14-R12
         LR    12,15             Establish base register
         USING main,12
         LR    11,13             Save caller's save area in R11
         LA    13,SAVEmain         Get our save area
         ST    11,4(,13)         Chain: our->prev = caller's
         ST    13,8(,11)         Chain: caller->next = ours
         LR    11,13             R11 = frame pointer (ebp)
*        R1 contains parameter list pointer
*        Parameters accessed via: L Rx,0(,1) for 1st, L Rx,4(,1) for 2nd, etc.
         AHI   13,-8
         LA    2,4
         LA    0,PLIST+0       Param slot address
         ST    2,0(,0)          Store param value
         LA    2,3
         LA    0,PLIST+4       Param slot address
         ST    2,0(,0)          Store param value
*        Call function: add
         LA    1,PLIST         R1 -> parameter list
         OI    PLIST+4,X'80'  Set VL bit on last param
         L     15,=V(add)      Load function address
         BALR  14,15            Call function
         LR    2,15             Copy return value to R2 (eax)
         AHI   13,8
         ST    2,68(,11)
         LA    2,2
         LA    0,PLIST+0       Param slot address
         ST    2,0(,0)          Store param value
         L     2,68(,11)
         LA    0,PLIST+4       Param slot address
         ST    2,0(,0)          Store param value
*        Call function: multiply
         LA    1,PLIST         R1 -> parameter list
         OI    PLIST+4,X'80'  Set VL bit on last param
         L     15,=V(multiply)      Load function address
         BALR  14,15            Call function
         LR    2,15             Copy return value to R2 (eax)
         AHI   13,8
         ST    2,64(,11)
         L     2,64(,11)
*        Return: R15 contains return code, F0 for float/double
         LR    15,2              Copy return value to R15
         L     13,4(,13)         Restore caller's save area
         LM    14,12,12(13)      Restore registers R14-R12
         BR    14                Return to caller
*
* Function: _main
* Convenção z/OS: R1=param list, R13=save area, R14=return, R15=entry
*
_main    DS    0H
         STM   14,12,12(13)      Save registers R14-R12
         LR    12,15             Establish base register
         USING _main,12
         LR    11,13             Save caller's save area in R11
         LA    13,SAVE_main         Get our save area
         ST    11,4(,13)         Chain: our->prev = caller's
         ST    13,8(,11)         Chain: caller->next = ours
         LR    11,13             R11 = frame pointer (ebp)
*        R1 contains parameter list pointer
*        Parameters accessed via: L Rx,0(,1) for 1st, L Rx,4(,1) for 2nd, etc.
         AHI   13,-4
*        Call function: main
         L     15,=V(main)      Load function address
         BALR  14,15            Call function
         LR    2,15             Copy return value to R2 (eax)
         ST    2,68(,11)
*        Return: R15 contains return code, F0 for float/double
         LR    15,2              Copy return value to R15
         L     13,4(,13)         Restore caller's save area
         LM    14,12,12(13)      Restore registers R14-R12
         BR    14                Return to caller
*
* Data Section
*
*
* Work Areas
*
SAVEAREA DS    18F               Register save area (72 bytes)
PLIST    DS    16F               Parameter list (up to 16 params)
FTEMP    DS    D                 Temp for float conversions
ITEMP    DS    F                 Temp for integer conversions
*
* Function-specific save areas
*
SAVEadd  DS    18F               Save area for add
SAVEmultiply DS    18F               Save area for multiply
SAVEmain DS    18F               Save area for main
SAVE_main DS    18F               Save area for _main
*
         LTORG                   Literal pool
*
*--------------------------------------------------------------------
* Notas sobre instruções de conversão:
* CDFBR F1,R2 - Convert from Fixed 32-bit to Long BFP (double)
* CFDBR R1,M3,F2 - Convert to Fixed 32-bit from Long BFP
*   M3=0: Use current rounding mode
*   M3=1: Round to nearest (ties to even)
*   M3=5: Round toward zero (truncate)
*   M3=6: Round toward +infinity
*   M3=7: Round toward -infinity
* Estas instruções requerem z/Architecture (z900+)
*--------------------------------------------------------------------
         END   CCPROG
